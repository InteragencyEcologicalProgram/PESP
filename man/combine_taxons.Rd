% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/global_funcs.R
\name{combine_taxons}
\alias{combine_taxons}
\title{Combine Taxon Records}
\usage{
combine_taxons(
  df,
  key_cols = c("Date", "Station"),
  measurement_cols = c("Biovolume_per_mL", "Units_per_mL", "Cells_per_mL")
)
}
\arguments{
\item{df}{A dataframe containing taxonomic records with columns such as
\code{Date}, \code{Station}, \code{Taxon}, and optional metadata fields.}

\item{key_cols}{Character vector of columns used to group taxon entries
(default: \code{c("Date", "Station")}).}

\item{measurement_cols}{Character vector of numeric columns to sum
(default: \code{c("Biovolume_per_mL", "Units_per_mL", "Cells_per_mL")}).}
}
\value{
A dataframe where:
\itemize{
\item Duplicate taxon rows per event are aggregated into one
\item Numeric measurements are summed
\item Qualitative fields (e.g., \code{Notes}, \code{Debris}) are combined
}

The returned dataframe includes a \code{log} attribute containing:
\itemize{
\item \strong{$combined_taxa}: dataframe of taxon groups that were merged
\item \strong{$combined_conflicts}: dataframe of columns where multiple distinct values were found within a group
}
}
\description{
Aggregates multiple taxon records within the same sampling event that differ only
in size or label schema or are duplicate entries.

Density columns are summed within each group. Text-based descriptor columns are merged
intelligently to retain relevant information.
\itemize{
\item If multiple distinct \code{OrigTaxon} values occur within a group, they are concatenated
into a single semicolon-separated string. When \code{OrigTaxon} is missing, the
corresponding \code{Taxon} is used instead.
\item If higher-level classification fields (\code{Kingdom}, \code{Phylum}, \code{Class}) disagree
within a group, the \code{Taxon} is replaced with \code{"Unknown <level>"} (e.g., \code{"Unknown phylum"}).
\item Only one row per unique \verb{(Date, Station, Taxon)} group is retained after aggregation.
\item A log of all combined taxa and column conflicts is attached as an attribute.
}
}
\details{
The following helper rules are used during aggregation:
\itemize{
\item \strong{Notes}: unique non-"NoNote" terms merged; \code{"MultipleEntries"} added if >1 distinct entry
\item \strong{QualityCheck}: merged similar to Notes, ignoring \code{"NoCode"}
\item \strong{Debris}: highest category preserved (\verb{High > Moderate > Low > None > Unknown})
\item \strong{PhytoForm}: merged unique forms alphabetically
\item \strong{GALD}: takes the maximum non-missing value
\item \strong{OrigTaxon}: concatenated with \code{"; "} if multiple distinct forms exist
}
}
