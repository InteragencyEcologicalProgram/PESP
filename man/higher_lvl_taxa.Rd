% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/global_funcs.R
\name{higher_lvl_taxa}
\alias{higher_lvl_taxa}
\title{Add Higher-Level Taxonomic Information}
\usage{
higher_lvl_taxa(df, after_col = NULL, std_type)
}
\arguments{
\item{df}{A dataframe with a \code{Taxon} column to enrich with classification metadata.}

\item{after_col}{Optional column name after which to insert the taxonomy fields (e.g., \code{"Taxon"}).}

\item{std_type}{Character; either \code{"program"} (default) or \code{"pesp"}, controlling how \code{cf.} taxa are standardized.}
}
\value{
A dataframe with additional taxa columns and a \code{log} attribute containing unmatched taxa
}
\description{
Appends hierarchical taxonomic classification fields to each record using a reference
taxonomy table read via \code{read_phyto_taxa()}. Matching is performed on a normalized
\code{PureTaxon} field derived from the \code{Taxon} column by:
\itemize{
\item Removing \code{"cf."} (case-insensitive)
\item Trimming whitespace and collapsing multiple spaces
\item Converting to lowercase for matching
}

The output taxonomy fields include \code{Kingdom}, \code{Phylum}, \code{Class}, \code{AlgalGroup},
\code{Genus}, and \code{Species}.

The behavior of the final \code{Taxon} column depends on \code{std_type}:
\itemize{
\item For \strong{both} modes, taxa formatted as \code{"Genus Species cf."} are normalized to \code{"Genus cf. Species"}.
\item For \strong{\code{std_type = "program"}} (default):
\itemize{
\item The \code{Taxon} column remains unchanged.
}
\item For \strong{\code{std_type = "pesp"}}:
\itemize{
\item Taxa such as \code{"Genus cf. Species"} are rewritten as \code{"Genus sp."}.
\item Taxa of the form \code{"cf. Genus Species"} are preserved as-is.
\item \code{"cf. Genus"} entries are standardized to \code{"Unknown <algal group>"} using
a predefined singular mapping (e.g., \code{"cf. Fragilaria"} → \code{"Unknown pennate diatom"}).
}
}

The original name is preserved in an \code{OrigTaxon} column (added if missing).
}
\details{
\itemize{
\item Synonym resolution is \strong{not} handled here — this function only appends classification fields.
\item Matching is case-insensitive and diacritic-insensitive.
\item If \code{after_col} is supplied, taxonomy columns are relocated immediately after it.
\item For \code{std_type = "pesp"}, \code{AlgalGroup} field is mapped to its singular form when replacing \code{"cf."} taxa.
}
}
